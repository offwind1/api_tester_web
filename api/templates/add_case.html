{% extends "base.html" %}
{% block title %}新增用例{% endblock %}
{% load staticfiles %}
{% block content %}

    <div class="am-modal am-modal-confirm" tabindex="-1" id="choce_api">
        <div class="am-modal-dialog">
            <div class="am-modal-hd">选择API</div>
            <form class="form-horizontal" id="form_choice">

                <div class="form-group">
                    <label class="control-label col-sm-3"
                           style="font-weight: inherit; font-size: small ">选择项目:</label>
                    <div class="col-sm-8">
                        <select class="form-control" id="project" name="project"
                                onchange="auto_load('#form_choice', '/project/get_module/', '#module', 'module')">
                            <option value="请选择">请选择</option>
                            {% for foo in project %}
                                <option value="{{ foo.project_name }}">{{ foo.project_name }}</option>
                            {% endfor %}
                        </select>
                    </div>

                </div>

                <div class="form-group">
                    <label class="control-label col-sm-3"
                           style="font-weight: inherit; font-size: small ">选择模块:</label>
                    <div class="col-sm-8">
                        <select class="form-control" id="module" name="module"
                                onchange="auto_load('#form_choice', '/api/get_api/', '#api', 'api')">
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="control-label col-sm-3"
                           style="font-weight: inherit; font-size: small ">选择API:</label>
                    <div class="col-sm-8">
                        <select class="form-control" id="api" name="api">
                        </select>
                    </div>
                </div>

            </form>
            <div class="am-modal-footer">
                <span class="am-modal-btn" data-am-modal-cancel>取消</span>
                <span class="am-modal-btn" data-am-modal-confirm>确定</span>
            </div>
        </div>
    </div>

    <div class="admin-biaogelist" xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html">

        <div class="am-tabs am-margin" style=" overflow:hidden; ">

            <div id="right" style="float: left; width: 25%; ">
                <form class="form-inline">
                    <button id="add_step" type="button" class="btn btn-primary">add Step</button>
                </form>
                <nav>
                    <ol id="pre_case">
                    </ol>
                </nav>
            </div>

            <div id="test" style="float: right; width: 70%;">

            </div>

            <div id="tab-step-list" style="float: right; width: 70%; display: none;">
                <div class="am-tabs am-margin" style="display: block">
                    <ul class="am-tabs-nav am-nav am-nav-tabs">
                        <li><a href="javascript:;" data-target="0">request</a></li>
                        <li><a href="javascript:;" data-target="1">extract/validate</a></li>
                    </ul>

                    <div>
                        <div class="am-tabs-bd">
                            <div class="am-tab-panel">
                                <div class="form-inline">
                                    <!--url-->
                                    <div class="form-group">
                                        <div class="input-group">
                                            <div class="input-group-addon">URL</div>
                                            <input type="text" class="form-control" id="url" name="url"
                                                   placeholder="api url">
                                        </div>
                                    </div>
                                    <!--Method-->
                                    <div class="form-group ">
                                        <div class="input-group">
                                            <div class="input-group-addon">Method</div>
                                            <select class="form-control" name="method" id="method">
                                                <option>POST</option>
                                                <option>GET</option>
                                                <option>PUT</option>
                                                <option>DELETE</option>
                                            </select>
                                        </div>
                                    </div>
                                    <!--Type-->
                                    <div class="form-group ">
                                        <div class="input-group">
                                            <div class="input-group-addon">Type</div>
                                            <select class="form-control" name="DataType" id="DataType">
                                                <option>data</option>
                                                <option>json</option>
                                            </select>
                                        </div>
                                    </div>

                                    <button class="btn btn-info" value="添 加" id="add_data" onclick="add_row('data')">add
                                        data
                                    </button>
                                    <button class="btn btn-danger" value="删 除" id="del_data" onclick="del_row('data')">
                                        del data
                                    </button>
                                    <button class="btn btn-info" value="添 加" onclick="add_row('header')">add headers
                                    </button>
                                    <button class="btn btn-danger" value="删 除" onclick="del_row('header')">del headers
                                    </button>


                                    <!--json-->
                                    <form id="form_request_data">

                                    <span style="font-size:10px;" id="json-text">
                                   <div style="margin-left: 0px; margin-top: 5px; height: 200px">
                                       <pre id="code" class="ace_editor ace-github"
                                            style="margin-top: 0px; margin-bottom: 0px; min-height: 200px; font-size: 17px;"><div
                                               style="position: absolute;"></div><textarea class="ace_text-input"
                                                                                           wrap="off" autocorrect="off"
                                                                                           autocapitalize="off"
                                                                                           spellcheck="false"
                                                                                           style="opacity: 0; height: 20px; width: 9.34688px; left: 47px; top: 60px;"></textarea><div
                                               class="ace_gutter"><div
                                               class="ace_layer ace_gutter-layer ace_folding-enabled"
                                               style="margin-top: 0px; height: 238px; width: 43px;"><div
                                               class="ace_gutter-cell " style="height: 20px;">1<span
                                               class="ace_fold-widget ace_start ace_open" style="height: 20px;"></span></div><div
                                               class="ace_gutter-cell " style="height: 20px;">2</div><div
                                               class="ace_gutter-cell " style="height: 20px;">3</div><div
                                               class="ace_gutter-cell " style="height: 20px;">4</div><div
                                               class="ace_gutter-cell " style="height: 20px;">5</div></div><div
                                               class="ace_gutter-active-line"
                                               style="top: 60px; height: 20px;"></div></div><div class="ace_scroller"
                                                                                                 style="left: 43px; right: 0px; bottom: 0px;"><div
                                               class="ace_content"
                                               style="margin-top: 0px; width: 492px; height: 238px; margin-left: 0px;"><div
                                               class="ace_layer ace_print-margin-layer"><div class="ace_print-margin"
                                                                                             style="left: 751.75px; visibility: visible;"></div></div><div
                                               class="ace_layer ace_marker-layer"><div class="ace_active-line"
                                                                                       style="height:20px;top:60px;left:0;right:0;"></div></div><div
                                               class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div
                                               class="ace_line_group" style="height:20px"><div class="ace_line"
                                                                                               style="height:20px"><span
                                               class="ace_paren ace_lparen">{</span></div></div><div
                                               class="ace_line_group" style="height:20px"><div class="ace_line"
                                                                                               style="height:20px">    <span
                                               class="ace_variable">"key"</span>: <span
                                               class="ace_string">"value"</span></div></div><div class="ace_line_group"
                                                                                                 style="height:20px"><div
                                               class="ace_line" style="height:20px"><span
                                               class="ace_paren ace_rparen">}</span></div></div><div
                                               class="ace_line_group" style="height:20px"><div class="ace_line"
                                                                                               style="height:20px"></div></div><div
                                               class="ace_line_group" style="height:20px"><div class="ace_line"
                                                                                               style="height:20px"><span
                                               class="ace_indent-guide">    </span><span
                                               class="ace_indent-guide">    </span><span
                                               class="ace_indent-guide">    </span><span
                                               class="ace_indent-guide">    </span><span
                                               class="ace_indent-guide">    </span><span
                                               class="ace_indent-guide">    </span><span
                                               class="ace_indent-guide">    </span><span
                                               class="ace_indent-guide">    </span><span
                                               class="ace_indent-guide">    </span>   </div></div></div><div
                                               class="ace_layer ace_marker-layer"></div><div
                                               class="ace_layer ace_cursor-layer ace_hidden-cursors"><div
                                               class="ace_cursor"
                                               style="left: 4px; top: 60px; width: 9.34688px; height: 20px;"></div></div></div></div><div
                                               class="ace_scrollbar ace_scrollbar-v"
                                               style="display: none; width: 22px; bottom: 0px;"><div
                                               class="ace_scrollbar-inner"
                                               style="width: 22px; height: 100px;"></div></div><div
                                               class="ace_scrollbar ace_scrollbar-h"
                                               style="display: none; height: 22px; left: 43px; right: 0px;"><div
                                               class="ace_scrollbar-inner"
                                               style="height: 22px; width: 492px;"></div></div><div
                                               style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: hidden;"><div
                                               style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font: inherit; overflow: visible;"></div><div
                                               style="height: auto; width: auto; top: 0px; left: 0px; visibility: hidden; position: absolute; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></pre>
                                   </div>
                                </span>

                                    </form>

                                    <!--data-->
                                    <form id="form_request_data">
                                        <table class="table table-hover table-condensed table-bordered table-striped"
                                               id="data">
                                            <caption>data:</caption>
                                            <thead>
                                            <tr class="active text-success">
                                                <th width="5%" align="center">Option</th>
                                                <th width="30%" align="center">Key</th>
                                                <th width="5%" align="center">Type</th>
                                                <th width="60%" align="center">Value</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            <tr>
                                                <td><input type="checkbox" name="data" style="width:55px"></td>
                                                <td><input type="text" name="test[][key]" value=""
                                                           style="width:100%; border: none"></td>
                                                <td><select name="test[][type]" class="form-control"
                                                            style="height: 25px; font-size: 15px; padding-top: 0px; padding-left: 0px; border: none">
                                                    <option>string</option>
                                                    <option>int</option>
                                                    <option>float</option>
                                                    <option>boolean</option>
                                                </select></td>
                                                <td><input type="text" name="test[][value]" value=""
                                                           style="width:100%; border: none"></td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </form>
                                    <!--header-->
                                    <form id="form_request_headers">
                                        <table class="table table-hover table-condensed table-bordered table-striped"
                                               id="header">
                                            <caption>headers:</caption>
                                            <thead>
                                            <tr class="active text-success">
                                                <th width="5%" align="center">Option</th>
                                                <th width="40%" align="center">Key</th>
                                                <th width="55%" align="center">Value</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            <tr>
                                                <td><input type="checkbox" name="header" style="width:55px">
                                                </td>
                                                <td><input type="text" name="test[][key]" value="headers_key"
                                                           style="width:100%; border: none"></td>
                                                <td><input type="text" name="test[][value]" value="headers_value"
                                                           style="width:100%; border: none"></td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </form>
                                </div>
                            </div>
                            <div class="am-tab-panel">
                                <button class="btn btn-info" value="添 加" onclick="add_row('extract')">add extract
                                </button>
                                <button class="btn btn-danger" value="删 除" onclick="del_row('extract')">del extract
                                </button>
                                <button class="btn btn-info" value="添 加" onclick="add_row('validate')">add validate
                                </button>
                                <button class="btn btn-danger" value="删 除" onclick="del_row('validate')">del validate
                                </button>

                                <form id="form_extract">
                                    <table class="table table-hover table-condensed table-bordered table-striped"
                                           id="extract">
                                        <caption>extract:</caption>
                                        <thead>
                                        <tr class="active text-success">
                                            <th width="5%" align="center">Option</th>
                                            <th width="30%" align="center">Key</th>
                                            <th width="55%" align="center">Value</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </form>

                                <form id="form_validate">
                                    <table class="table table-hover table-condensed table-bordered table-striped"
                                           id="validate">
                                        <caption>validate:</caption>
                                        <thead>
                                        <tr class="active text-success">
                                            <th width="2%" align="center">Option</th>
                                            <th width="32%" align="center">Check</th>
                                            <th width="10%" align="center">Comparator</th>
                                            <th width="8%" align="center">Type</th>
                                            <th width="48%" align="center">Expected</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </form>

                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </div>

    <script>
        editor = null;

        $(function () {
            $("#pre_case").sortable();
            $("#pre_case").disableSelection();
        });

        $('#add_step').on('click', function () {
            $('#choce_api').modal({
                relatedTarget: this,
                onConfirm: function () {
                    add_step();
                },
                onCancel: function () {
                }
            });

        });

        function add_step() {
            var data = $("#form_choice").serializeJSON()
            $.ajax({
                type: 'post',
                url: "/api/get_api_request/",
                data: JSON.stringify(data),
                contentType: "application/json",
                success: function (data) {
                    show_step(data);
                },
                error: function () {
                    myAlert('Sorry，服务器可能开小差啦, 请重试!');
                }
            });
        }

        var step_index = 0;

        function show_step(data) {
            console.log(data);
            step_index++;
            add_li(data, step_index)
            add_editer(data, step_index)
        }

        function add_li(data, index) {
            var api = data["test"]
            var api_id = data["id"]

            var li = $('<li style=\'margin-left:15px\'>' +
                '    <label for="' + step_index + '">API:' + api.name.case_name + ' StepName:</label>' +
                '    <input type="text" name="step_name" id="' + step_index + '">' +
                '</li>');

            var temp = $("<i class=\"js - remove\">✖</i>");
            temp.on("click", function () {
                $(this).parent("li").remove();
            });
            $("#pre_case").append(li);
        }

        function add_editer(data, index) {
            var api = data.test;
            var request = api.request;
            var extract = api.extract;
            var validate = api.validate;


            var panel1 = $(`<div class="am-tab-panel"></div>`);


            var request_view = get_request(request);

            panel1.append(request_view)

        }

        function get_panel2_view(extract, validate) {
            var panel2 = $(`<div class="am-tab-panel"></div>`);

            var buttons = $(`<button class="btn btn-info" value="添 加" onclick="add_row('extract_`+step_index+`')">add extract</button>
                            <button class="btn btn-danger" value="删 除" onclick="del_row('extract_`+step_index+`')">del extract</button>
                            <button class="btn btn-info" value="添 加" onclick="add_row('validate_`+step_index+`')">add validate</button>
                            <button class="btn btn-danger" value="删 除" onclick="del_row('validate_`+step_index+`')">del validate</button>`)

            var extract_view = get_extract_view(extract);
            

        }

        function get_extract_view(extract) {
            var form = $(`<form id="form_extract_`+step_index+`"></form>`);
            var table = $(`<table class="table table-hover table-condensed table-bordered table-striped" id="extract_`+step_index+`"></table>`);

            table.append($(`<caption>extract:</caption>
                            <thead>
                            <tr class="active text-success">
                                <th width="5%" align="center">Option</th>
                                <th width="30%" align="center">Key</th>
                                <th width="55%" align="center">Value</th>
                            </tr>
                            </thead>`));

            var tbody = $(`<tbody></tbody>`);
            
            for (var i in extract.test) {
                var key = extract.test[i].key;
                var value = extract.test[i].value;

                var checkbox = `<td><input type="checkbox" name="extract_`+step_index+`" style="width:55px"></td>`;
                var extract_key = `<td><input type="text" name="test[][key]" value="`+key+`" style="width:100%; border: none"></td>`;
                var extract_value = `<td><input type="text" name="test[][value]" value="`+value+`" style="width:100%; border: none"></td>`;

                tbody.append($(`<tr>`+checkbox+extract_key+extract_value+`</tr>`));
            }
            table.append(tbody);
            form.append(table);
            return form
        }

        function get_validate_view(validate) {
            `<form id="form_validate">
                <table class="table table-hover table-condensed table-bordered table-striped"
                       id="validate">
                    <caption>validate:</caption>
                    <thead>
                    <tr class="active text-success">
                        <th width="2%" align="center">Option</th>
                        <th width="32%" align="center">Check</th>
                        <th width="10%" align="center">Comparator</th>
                        <th width="8%" align="center">Type</th>
                        <th width="48%" align="center">Expected</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td><input type="checkbox" name="validate" style="width:55px"></td>
                        <td><input type="text" name="test[][key]" value="validate_check" style="width:100%; border: none"></td>
                        <td><select name="test[][comparator]" class="form-control" style="height: 25px; font-size: 15px; padding-top: 0px; padding-left: 0px; border: none">

                                <option selected="">equals</option>
                                <option>contains</option>
                                <option>startswith</option>
                                <option>endswith</option>
                                <option>regex_match</option>
                                <option>type_match</option>
                                <option>contained_by</option>
                                <option>less_than</option>
                                <option>less_than_or_equals</option>
                                <option>greater_than</option>
                                <option>greater_than_or_equals</option>
                                <option>not_equals</option>
                                <option>string_equals</option>
                                <option>length_equals</option>
                                <option>length_greater_than</option>
                                <option>length_greater_than_or_equals</option>
                                <option>length_less_than</option>
                                <option>length_less_than_or_equals</option>
                        </select></td>
                        <td>
                            <select name="test[][type]" class="form-control" style="height: 25px; font-size: 15px; padding-top: 0px; padding-left: 0px; border: none">
                                    <option>string</option>
                                    <option>int</option>
                                    <option>float</option>
                                    <option>boolean</option>
                            </select>
                        </td>
                        <td><input type="text" name="test[][value]" value="validate_expected" style="width:100%; border: none"></td>
                    </tr>
                    </tbody>
                </table>
            </form>`




        }

        function get_request(request) {

            var headers = request.headers;
            var method = request.method;
            var request_data = request.request_data;
            var type = request.type;
            var url = request.url;

            var url_view = get_url_view(url);
            var method_view = get_method_view(method);
            var type_view = get_type_view(type);
            var buttons = get_buttons_view()
            var data_view = get_data_view(request_data, type);
            var headers_view = get_headers_view(headers)

            var form_inline = $(`<div class="form-inline"></div>`)


            form_inline.append(url_view)
            form_inline.append(method_view)
            form_inline.append(type_view)

            form_inline.append(buttons)

            form_inline.append(data_view)
            form_inline.append(headers_view)

            try {
                editor = ace.edit("code_" + step_index);
                init_acs('json', 'github', editor);
            } catch (err) {
                editor = null;
            }

            return form_inline
        }

        function get_url_view(url) {
            var url_view = $(`<div class="form-group">
                    <div class="input-group">
                        <div class="input-group-addon">URL</div>
                        <input type="text" class="form-control" name="url" id="url_` + step_index + `" value="` + url + `"
                               placeholder="api url">
                    </div>
                </div>
                `);
            return url_view
        }

        function get_method_view(method) {
            var option;
            if (method === "POST") {
                option = `<option>POST</option><option>GET</option>`
            } else if (method === "GET") {
                option = `<option>GET</option><option>POST</option>`
            }

            var method_view = $(`<div class="form-group ">
                    <div class="input-group">
                        <div class="input-group-addon">Method</div>
                        <select class="form-control" id="method_` + step_index + `" name="method">
                            ` + option + `
                        </select>
                    </div>
                </div>`)

            return method_view
        }

        function get_type_view(type) {
            var option;
            if (type === "data") {
                option = `<option>data</option><option>json</option>`
            } else if (type === "json") {
                option = `<option>json</option><option>data</option>`
            }

            var type_view = $(`<div class="form-group ">
                                    <div class="input-group">
                                        <div class="input-group-addon">Type</div>
                                        <select class="form-control" onchange="select_func(`+step_index+`)" name="DataType" id="DataType_` + step_index + `">
                                        ` + option + `
                                        </select>
                                    </div>
                                </div>`);
            return type_view
        }

        function get_buttons_view(type) {
            var attr = ""
            if (type === "josn"){
                attr = `disabled="disabled"`;
            }

            var b1 = `<button class="btn btn-info" `+attr+` value="添 加" id="add_data_`+step_index+`" onclick="add_row('data_`+step_index+`')">add data </button>`;
            var b2 = `<button class="btn btn-danger" `+attr+` value="删 除" id="del_data_`+step_index+`" onclick="del_row('data_`+step_index+`')">del data</button>`;
            var b3 = `<button class="btn btn-info" value="添 加" onclick="add_row('header_`+step_index+`')">add headers</button>`;
            var b4 = `<button class="btn btn-danger" value="删 除" onclick="del_row('header_`+step_index+`')">del headers</button>`;

            return $(b1+b2+b3+b4);
        }

        function get_data_view(request_data, type) {
            var form = $(`<form id="form_request_data_` + step_index + `"></form>`);

            if (type === "data") {

                var table = $(`<table class="table table-hover table-condensed table-bordered table-striped"
                            id="data_` + step_index + `"></table>`);
                table.append($(`<caption>data:</caption>`));

                var thead = $(`<thead></thead>`);
                thead.append($(`<tr class="active text-success">
                        <th width="5%" align="center">Option</th>
                        <th width="30%" align="center">Key</th>
                        <th width="15%" align="center">Type</th>
                        <th width="50%" align="center">Value</th>
                    </tr>`));

                var tbody = $(`<tbody></tbody>`);

                for (var test in request_data.test) {
                    var key = request_data.test[test].key;
                    var type = request_data.test[test].type;
                    var value = request_data.test[test].value;

                    var checkbox = `<td><input type="checkbox" name="data_`+step_index+`" style="width:55px"></td>`;
                    var key_text = `<td><input type="text" name="test[][key]" value="` + key + `" style="width:100%; border: none"></td>`;
                    var option = get_option_text(type);
                    var select = `<td>
                                <select name="test[][type]" class="form-control" style="height: 25px;
                                    font-size: 15px; padding-top: 0px; padding-left: 0px; border: none">
                                ` + option + `
                                </select>
                            </td>`;
                    var value_text = `<td><input type="text" name="test[][value]" value="` + value + `" style="width:100%; border: none"></td>`;

                    var data = $(`<tr>` + checkbox + key_text + select + value_text + `</tr>`);
                    tbody.append(data);
                }

                table.append(thead);
                table.append(tbody)
                form.append(table);

            } else if (type === "json") {
                var json_view = $(`<span style="font-size:10px;" id="json-text">
                   <div style="margin-left: 0px; margin-top: 5px; height: 200px">
                       <pre id="code_` + step_index + `" class="ace_editor"
                            style="margin-top: 0px; margin-bottom: 0px; min-height: 200px;">
<textarea style="left: 0px">
` + JSON.stringify(request_data) + `
</textarea>
                       </pre>
                   </div>
                </span>`);

                form.append(json_view);
            }
            return form
        }

        function get_option_text(type) {
            var type_list = ["string", "int", "float", "boolean"];
            var option = `<option>` + type + `</option>`;
            for (var t in type_list) {
                if (type_list[t] !== type) {
                    option = option + `<option>` + type_list[t] + `</option>`
                }
            }
            return option;
        }

        function get_headers_view(headers){
            var form = $(`<form id="form_request_headers_`+step_index+`"></form>`);
            var table = $(`<table class="table table-hover table-condensed table-bordered table-striped"
                       id="header_`+step_index+`"></table>`);

            table.append($(`<caption>headers:</caption>
                    <thead>
                    <tr class="active text-success">
                        <th width="5%" align="center">Option</th>
                        <th width="40%" align="center">Key</th>
                        <th width="55%" align="center">Value</th>
                    </tr>
                    </thead>`));
            var tbody = $(`<tbody></tbody>`);

            for(var i in headers.test){
                var key = headers.test[i].key;
                var value = headers.test[i].value;

                var checkbox = `<td><input type="checkbox" name="header_`+step_index+`" style="width:55px"></td>`;
                var text_input = `<td><input type="text" name="test[][key]" value="`+key+`" style="width:100%; border: none"></td>`;
                var value_input = `<td><input type="text" name="test[][value]" value="`+value+`"
                                   style="width:100%; border: none"></td>`;
                var header = $(`<tr>`+checkbox+text_input+value_input+`</tr>`);
                tbody.append(header);
            }
            table.append(tbody);
            form.append(table);


            return form
        }



        $('#DataType').on('change', function () {
            if ($('#DataType').val() === 'json') {
                $('#add_data').attr('disabled', true);
                $('#del_data').attr('disabled', true);
                $('#data').remove();
                var json_text = "<span style=\"font-size:10px;\" id=\"json-text\">\n" +
                    " <div style=\"margin-left: 0px; margin-top: 5px; height: 200px\">" +
                    "<pre id=\"code\" class=\"ace_editor\" style=\"margin-top: 0px; margin-bottom: 0px; min-height: 200px;\">\n" +
                    "<textarea>\n" +
                    "{\"key\":\"value\"}\n" +
                    "</textarea>\n" +
                    "</pre></div></span>";

                $('#form_request_data').append(json_text);

                editor = ace.edit("code");
                init_acs('json', 'github', editor);
            } else {
                var table = '<table class="table table-hover table-condensed table-bordered table-striped" id="data">\n' +
                    '                                <caption>' + $('#DataType').val() + ':</caption>\n' +
                    '                                <thead>\n' +
                    '                                <tr class="active text-success">\n' +
                    '                                    <th width="5%" align="center">Option</th>\n' +
                    '                                    <th width="30%" align="center">Key</th>\n' +
                    '                                    <th width="5%" align="center">Type</th>\n' +
                    '                                    <th width="60%" align="center">Value</th>\n' +
                    '                                </tr>\n' +
                    '                                </thead>\n' +
                    '                                <tbody>\n' +
                    '                                </tbody>\n' +
                    '                            </table>';

                $('#add_data').text('add ' + $('#DataType').val());
                $('#del_data').text('del ' + $('#DataType').val());

                $('#add_data').removeAttr("disabled");
                $('#del_data').removeAttr("disabled");
                $('#data').remove();
                $('#json-text').remove();
                $('#form_request_data').append(table);
            }
        });

        $("#tab-step-list ul").on("click", "li", function () {
            $(this).addClass("am-active").siblings("li").removeClass("am-active");
            var i = parseInt($(this).children("a").attr("data-target"));
            var asd = $(this).parent("ul").parent("div").find(".am-tab-panel")[i]

            $(asd).addClass("am-active").siblings(".am-tab-panel").removeClass("am-active");
        });

        function select_func (index) {
            if ($('#DataType_'+index).val() === 'json') {
                $('#add_data_'+index).attr('disabled', true);
                $('#del_data_'+index).attr('disabled', true);
                $('#data_'+index).remove();
                var json_text = "<span style=\"font-size:10px;\" id=\"json-text_"+index+"\">\n" +
                    " <div style=\"margin-left: 0px; margin-top: 5px; height: 200px\">" +
                    "<pre id=\"code_"+index+"\" class=\"ace_editor\" style=\"margin-top: 0px; margin-bottom: 0px; min-height: 200px;\">\n" +
                    "<textarea>\n" +
                    "{\"key\":\"value\"}\n" +
                    "</textarea>\n" +
                    "</pre></div></span>";
                $('#form_request_data_'+index).append(json_text);
                editor = ace.edit("code_"+index);
                init_acs('json', 'github', editor);

            } else {
                var table = '<table class="table table-hover table-condensed table-bordered table-striped" id="data_'+index+'">\n' +
                    '                                <caption>' + $('#DataType').val() + ':</caption>\n' +
                    '                                <thead>\n' +
                    '                                <tr class="active text-success">\n' +
                    '                                    <th width="5%" align="center">Option</th>\n' +
                    '                                    <th width="30%" align="center">Key</th>\n' +
                    '                                    <th width="5%" align="center">Type</th>\n' +
                    '                                    <th width="60%" align="center">Value</th>\n' +
                    '                                </tr>\n' +
                    '                                </thead>\n' +
                    '                                <tbody>\n' +
                    '                                </tbody>\n' +
                    '                            </table>';

                $('#add_data_'+index).text('add ' + $('#DataType_'+index).val());
                $('#del_data_'+index).text('del ' + $('#DataType_'+index).val());

                $('#add_data_'+index).removeAttr("disabled");
                $('#del_data_'+index).removeAttr("disabled");
                $('#data_'+index).remove();
                $('#json-text_'+index).remove();
                $('#form_request_data_'+index).append(table);
            }
        }

    </script>

{% endblock %}


